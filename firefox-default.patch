diff -up firefox-3.5.10/mozilla-1.9.1/browser/components/preferences/advanced.xul.default firefox-3.5.10/mozilla-1.9.1/browser/components/preferences/advanced.xul
--- firefox-3.5.10/mozilla-1.9.1/browser/components/preferences/advanced.xul.default	2010-05-04 17:55:27.000000000 +0200
+++ firefox-3.5.10/mozilla-1.9.1/browser/components/preferences/advanced.xul	2010-06-24 13:34:26.000000000 +0200
@@ -182,7 +182,7 @@
                       preference="layout.spellcheckDefault"/>
           </groupbox>
 
-#ifdef HAVE_SHELL_SERVICE
+#ifdef 0
           <!-- System Defaults -->
           <groupbox id="systemDefaultsGroup" orient="horizontal">
             <caption label="&systemDefaults.label;"/>
diff -up firefox-3.5.10/mozilla-1.9.1/browser/components/shell/src/nsGNOMEShellService.cpp.default firefox-3.5.10/mozilla-1.9.1/browser/components/shell/src/nsGNOMEShellService.cpp
--- firefox-3.5.10/mozilla-1.9.1/browser/components/shell/src/nsGNOMEShellService.cpp.default	2010-05-04 17:55:27.000000000 +0200
+++ firefox-3.5.10/mozilla-1.9.1/browser/components/shell/src/nsGNOMEShellService.cpp	2010-06-24 13:33:25.000000000 +0200
@@ -142,27 +142,21 @@ NS_IMPL_ISUPPORTS1(nsGNOMEShellService, 
 PRBool
 nsGNOMEShellService::KeyMatchesAppName(const char *aKeyValue) const
 {
+  nsCAutoString appName;
 
-  gchar *commandPath;
   if (mUseLocaleFilenames) {
     gchar *nativePath = g_filename_from_utf8(aKeyValue, -1, NULL, NULL, NULL);
     if (!nativePath) {
       NS_ERROR("Error converting path to filesystem encoding");
       return PR_FALSE;
     }
-
-    commandPath = g_find_program_in_path(nativePath);
+    appName.Assign(nativePath);
     g_free(nativePath);
   } else {
-    commandPath = g_find_program_in_path(aKeyValue);
+    appName.Assign(aKeyValue);
   }
-
-  if (!commandPath)
-    return PR_FALSE;
-
-  PRBool matches = mAppPath.Equals(commandPath);
-  g_free(commandPath);
-  return matches;
+  // Compare default browser command retrieved from gconf with MOZ_APP_NAME
+  return appName.EqualsLiteral(MOZ_APP_NAME);
 }
 
 NS_IMETHODIMP
@@ -218,8 +212,8 @@ nsGNOMEShellService::SetDefaultBrowser(P
   nsCOMPtr<nsIGConfService> gconf = do_GetService(NS_GCONFSERVICE_CONTRACTID);
 
   nsCAutoString schemeList;
-  nsCAutoString appKeyValue(mAppPath);
-  appKeyValue.Append(" \"%s\"");
+  nsCAutoString appKeyValue(MOZ_APP_NAME);
+  appKeyValue.Append(" %s");
   unsigned int i;
 
   for (i = 0; i < NS_ARRAY_LENGTH(appProtocols); ++i) {
diff -up firefox-3.5.10/mozilla-1.9.1/browser/components/shell/src/nsGNOMEShellService.h.default firefox-3.5.10/mozilla-1.9.1/browser/components/shell/src/nsGNOMEShellService.h
--- firefox-3.5.10/mozilla-1.9.1/browser/components/shell/src/nsGNOMEShellService.h.default	2010-05-04 17:55:27.000000000 +0200
+++ firefox-3.5.10/mozilla-1.9.1/browser/components/shell/src/nsGNOMEShellService.h	2010-06-24 13:33:25.000000000 +0200
@@ -43,7 +43,7 @@
 class nsGNOMEShellService : public nsIShellService
 {
 public:
-  nsGNOMEShellService() : mCheckedThisSession(PR_FALSE) { }
+  nsGNOMEShellService() : mCheckedThisSession(PR_TRUE) { }
 
   NS_DECL_ISUPPORTS
   NS_DECL_NSISHELLSERVICE
